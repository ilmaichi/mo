<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio | Michele Occhi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #f7f7f2; --dark-blue: #004f5e; --accent-coral: #ff6f61;  
            --accent-gold: #ffc857; --text-light: #f7f7f2; --dark-text: #2d2926; 
        }

        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; background-color: var(--bg-color); font-family: 'Inter', sans-serif; overflow-x: hidden; scroll-behavior: smooth; }
        
        /* --- CURSORE (Solo Desktop) --- */
        #cursor-container { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; z-index: 9999; display: none; 
        }
        @media (pointer: fine) { 
            body, a, button { cursor: none !important; } 
            #cursor-container { display: block; }
        }
        #custom-cursor {
            position: absolute; width: 30px; fill: var(--accent-coral);
            will-change: transform; transition: width 0.3s ease, height 0.3s ease;
        }
        #custom-cursor.expanding { width: 75px; }
        .drop { position: absolute; width: 12px; fill: var(--accent-coral); opacity: 0.6; pointer-events: none; }

        /* --- UI LABELS --- */
        .ui-label {
            position: fixed; z-index: 10001; font-family: 'JetBrains Mono'; font-size: 11px; 
            text-transform: uppercase; color: #fff; mix-blend-mode: difference;
        }
        #label-name { top: 45px; left: 40px; letter-spacing: 0.2em; }
        #nav-text-menu { top: 45px; right: 40px; padding: 10px; cursor: pointer; }

        /* --- TAP & TILT UI (Mobile Only) --- */
        #gyro-cta {
            position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column; align-items: center; gap: 12px;
            z-index: 20; font-family: 'JetBrains Mono'; font-size: 10px; 
            text-transform: uppercase; color: var(--dark-text);
            transition: opacity 0.5s ease, transform 0.5s ease;
            pointer-events: none; /* Il tap viene gestito dal body */
        }
        @media (pointer: fine) { #gyro-cta { display: none; } }
        #gyro-cta.hidden { opacity: 0; transform: translate(-50%, 20px); }
        .phone-icon { width: 20px; height: 34px; border: 1.5px solid var(--dark-text); border-radius: 3px; position: relative; animation: tilt 2s infinite ease-in-out; }
        @keyframes tilt { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(15deg); } }

        /* --- LOGO & STRUTTURA --- */
        #hero-logo-wrapper { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 480px; max-width: 85vw; z-index: 5; }
        .logo-svg { width: 100%; height: auto; display: block; }
        .st0 { fill: var(--accent-coral); } .st2 { fill: var(--accent-gold); }
        .intero-occhio { transform-origin: 435px 245px !important; }
        .blinking { transform: scaleY(0.01) !important; }
    </style>
</head>
<body onclick="handleGlobalClick()">

    <div id="cursor-container">
        <div id="custom-cursor">
            <svg viewBox="0 0 500 465.69"><path d="M440.18,416.13c-59.25,54.74-144.98,53.73-221.98,45.24-36.38-4.01-73.01-9.15-107.35-22.91-34.33-13.76-66.57-36.95-86.47-70.65C5.82,336.36-.83,297.79.08,260.31,2.95,142.22,85.02,31.92,189.74,5.44c44.07-11.14,95.41-4.61,143.77,14.51,60.76,24.02,111.92,71.39,141.42,134.54,8.1,17.33,14.52,35.57,18.9,54.6,16.91,73.35-.95,158.38-53.65,207.04Z"/></svg>
        </div>
    </div>

    <section style="height: 100vh; position: relative;">
        <div id="hero-logo-wrapper">
            <svg class="logo-svg" viewBox="0 0 500 328.12">
                <defs><mask id="m-hero"><rect width="500" height="400" fill="white"/><g class="p-mover"><circle cx="425" cy="245" r="14" fill="black"/></g></mask></defs>
                <path class="st0" d="M330.22,220.62..."/> <g class="intero-occhio" style="mask: url(#m-hero);"><path class="st0" d="M480.03,305.97..."/></g>
            </svg>
        </div>

        <div id="gyro-cta">
            <div class="phone-icon"></div><span>Tap & Tilt</span>
        </div>
    </section>

    <script>
        const isDesktop = window.matchMedia("(pointer: fine)").matches;
        const hLog = document.getElementById('hero-logo-wrapper');
        const hp = { eye: hLog.querySelector('.intero-occhio'), pup: hLog.querySelector('.p-mover') };
        const cursor = document.getElementById('custom-cursor'), container = document.getElementById('cursor-container');
        
        let mX = window.innerWidth/2, mY = window.innerHeight/2, cX = mX, cY = mY;
        let tPX = mX, tPY = mY, cPX = mX, cPY = mY; 
        let currentRotation = 0, currentStretchX = 1, currentStretchY = 1, breathTime = 0;
        let gyroActive = false;

        // --- GESTIONE INPUT ---
        if (isDesktop) {
            document.addEventListener('mousemove', (e) => {
                mX = e.clientX; mY = e.clientY;
                tPX = e.clientX; tPY = e.clientY;
            });
        }

        function handleGlobalClick() {
            if (!isDesktop && !gyroActive) {
                requestGyroPermission();
            }
        }

        function requestGyroPermission() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(res => { if (res === 'granted') setupGyro(); });
            } else { setupGyro(); }
        }

        function setupGyro() {
            gyroActive = true;
            document.getElementById('gyro-cta').classList.add('hidden');
            window.addEventListener('deviceorientation', (e) => {
                tPX = window.innerWidth/2 + (e.gamma * 15);
                tPY = window.innerHeight/2 + ((e.beta - 45) * 15);
            });
        }

        // --- ANIMAZIONE LOOP ---
        function lerpAngle(s, e, a) { const d = ((e - s + 180) % 360 + 360) % 360 - 180; return s + d * a; }

        function update() {
            if (isDesktop) {
                const dx = mX - cX, dy = mY - cY;
                cX += dx * 0.15; cY += dy * 0.15;
                const speed = Math.hypot(dx, dy), angle = Math.atan2(dy, dx) * (180/Math.PI);
                let tRot, tSX, tSY;
                if (speed < 1) {
                    breathTime += 0.05;
                    tSX = 1 + Math.sin(breathTime)*0.1; tSY = 1 + Math.cos(breathTime*0.8)*0.12; tRot = Math.sin(breathTime*0.5)*5;
                } else {
                    const s = Math.min(speed/400,0.6); tSX = 1+s; tSY = 1-s; tRot = angle;
                }
                currentRotation = lerpAngle(currentRotation, tRot, 0.1);
                currentStretchX += (tSX - currentStretchX) * 0.15;
                currentStretchY += (tSY - currentStretchY) * 0.15;
                cursor.style.transform = `translate(${cX}px, ${cY}px) translate(-50%, -50%) rotate(${currentRotation}deg) scale(${currentStretchX}, ${currentStretchY})`;
            }

            cPX += (tPX - cPX) * 0.1; cPY += (tPY - cPY) * 0.1;
            const solve = (eye, r) => {
                const rect = eye.getBoundingClientRect();
                const dx = cPX - (rect.left + rect.width/2), dy = cPY - (rect.top + rect.height/2);
                const a = Math.atan2(dy, dx), d = Math.min(Math.hypot(dx, dy)/400, 1);
                return { x: Math.cos(a)*r*d, y: Math.sin(a)*r*d };
            };
            hp.pup.style.transform = `translate(${solve(hp.eye, 70).x}px, ${solve(hp.eye, 70).y}px)`;
            requestAnimationFrame(update);
        }
        update();
    </script>
</body>
</html>
